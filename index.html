<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业音频调音台模拟器 - 完整版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff8a00;
            --secondary-color: #e52e71;
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --panel-bg: rgba(30, 30, 46, 0.9);
            --panel-border: rgba(255, 255, 255, 0.1);
            --text-color: #fff;
            --text-muted: #a0a0c0;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --pro-mode-color: #9b59b6;
            --beginner-mode-color: #3498db;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s ease;
            --border-radius: 10px;
            --neon-glow: 0 0 10px rgba(255, 138, 0, 0.7), 0 0 20px rgba(255, 138, 0, 0.5), 0 0 30px rgba(255, 138, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            z-index: 1;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }

        .header-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px;
            border-radius: 30px;
        }

        .mode-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 0 15px rgba(255, 138, 0, 0.5);
        }

        .mode-btn:not(.active) {
            background: transparent;
            color: var(--text-muted);
        }

        .mode-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 25px;
            transition: var(--transition);
        }

        .language-selector:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .language-selector select {
            background: transparent;
            border: none;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            outline: none;
        }

        .language-selector select option {
            background: var(--dark-bg);
            color: white;
        }

        /* 新增音乐信息面板样式 */
        .music-info-panel {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--panel-border);
            display: flex;
            gap: 25px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .music-info-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .music-cover {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .music-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.1) 100%);
        }

        .music-cover i {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.3);
        }

        .music-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .music-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .music-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .music-artist {
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .music-stats {
            display: flex;
            gap: 30px;
            margin-top: 10px;
        }

        .music-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--info-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .music-progress {
            width: 100%;
            margin-top: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .progress-time {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .music-analysis {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .analysis-item {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .analysis-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--success-color);
        }

        .analysis-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .mixer-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .channels-section {
            flex: 3;
            min-width: 0;
        }

        .channels-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 15px 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        .channels-container::-webkit-scrollbar {
            height: 8px;
        }

        .channels-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .channels-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .channel {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            width: 160px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--panel-border);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .channel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .channel.active::before {
            transform: scaleX(1);
        }

        .channel:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .channel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--panel-border);
        }

        .channel-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .channel-meter {
            width: 10px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .channel-meter-level {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, var(--success-color), var(--warning-color), var(--danger-color));
            transition: height 0.05s;
            height: 0%;
            border-radius: 0 0 5px 5px;
        }

        .channel-meter-peak {
            position: absolute;
            width: 100%;
            height: 2px;
            background: white;
            transition: bottom 0.1s;
            bottom: 0;
        }

        .channel-controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-source {
            margin-bottom: 10px;
        }

        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 5px;
            text-align: center;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.7rem;
            height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0);
            transition: var(--transition);
            z-index: 0;
        }

        .drop-zone:hover {
            border-color: var(--success-color);
        }

        .drop-zone:hover::before {
            background: rgba(76, 175, 80, 0.1);
        }

        .drop-zone p {
            margin: 2px 0;
            position: relative;
            z-index: 1;
        }

        .drop-zone .file-icon {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--success-color);
            position: relative;
            z-index: 1;
        }

        .mic-btn {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
            border: none;
            color: white;
            padding: 8px 12px;
            text-align: center;
            text-decoration: none;
            display: block;
            font-size: 0.8rem;
            margin: 5px auto 0;
            cursor: pointer;
            border-radius: 20px;
            transition: var(--transition);
            width: 90%;
            position: relative;
            overflow: hidden;
        }

        .mic-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .mic-btn:hover::before {
            left: 100%;
        }

        .mic-btn:hover {
            background: linear-gradient(135deg, #2980b9, var(--info-color));
            transform: scale(1.05);
        }

        .mic-btn.active {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 5px;
            text-align: center;
            font-weight: 500;
        }

        .fader {
            height: 140px;
            width: 100%;
            position: relative;
            display: flex;
            justify-content: center;
        }

        .fader-track {
            width: 8px;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .fader-thumb {
            width: 24px;
            height: 14px;
            background: var(--primary-color);
            border-radius: 4px;
            position: absolute;
            left: -8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            z-index: 2;
        }

        .fader-thumb:hover {
            background: #ff9a3d;
            box-shadow: 0 2px 8px rgba(255, 138, 0, 0.5);
        }

        .knob {
            width: 50px;
            height: 50px;
            margin: 0 auto;
            position: relative;
        }

        .knob-dial {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #333;
            border: 2px solid #555;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            cursor: pointer;
        }

        .knob-indicator {
            width: 3px;
            height: 18px;
            background: var(--primary-color);
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: bottom center;
            border-radius: 2px;
        }

        .knob-value {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 5px;
        }

        .channel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 0.75rem;
            cursor: pointer;
            border-radius: 15px;
            transition: var(--transition);
            flex: 1;
            margin: 0 2px;
            position: relative;
            overflow: hidden;
        }

        .channel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0);
            transition: var(--transition);
        }

        .channel-btn:hover::before {
            background: rgba(255, 255, 255, 0.1);
        }

        .channel-btn:hover {
            transform: translateY(-2px);
        }

        .channel-btn.active {
            background: var(--primary-color);
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.5);
        }

        .master-section {
            flex: 1;
            min-width: 380px;
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--panel-border);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .master-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .master-controls {
            flex: 1;
        }

        .master-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--panel-border);
            text-align: center;
            font-size: 1.6rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .master-fader {
            height: 220px;
            width: 70px;
            margin: 0 auto 20px;
            position: relative;
        }

        .master-fader-track {
            width: 12px;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            position: relative;
            margin: 0 auto;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .master-fader-thumb {
            width: 35px;
            height: 22px;
            background: var(--primary-color);
            border-radius: 6px;
            position: absolute;
            left: -11.5px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            z-index: 2;
        }

        .master-fader-thumb:hover {
            background: #ff9a3d;
            box-shadow: 0 2px 8px rgba(255, 138, 0, 0.5);
        }

        .eq-section {
            margin-bottom: 25px;
        }

        .eq-title {
            color: var(--info-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .eq-bands {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .eq-band {
            text-align: center;
        }

        .filter-section {
            margin-bottom: 25px;
        }

        .filter-title {
            color: var(--pro-mode-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .filter-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .filter-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-slider label {
            font-size: 0.85rem;
            width: 70px;
            color: var(--text-muted);
        }

        .filter-slider input {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }

        .filter-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .filter-slider input::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
        }

        .gain-section {
            margin-bottom: 25px;
        }

        .gain-title {
            color: var(--success-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .gain-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .gain-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gain-slider label {
            font-size: 0.85rem;
            width: 70px;
            color: var(--text-muted);
        }

        .gain-slider input {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }

        .gain-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--success-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .gain-slider input::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--success-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
        }

        .transport-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .transport-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .transport-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .transport-btn:hover::before {
            left: 100%;
        }

        .play-btn {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        .play-btn:hover {
            background: linear-gradient(135deg, #27ae60, var(--success-color));
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(46, 204, 113, 0.4);
        }

        .stop-btn {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
        }

        .stop-btn:hover {
            background: linear-gradient(135deg, #c0392b, var(--danger-color));
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            box-shadow: var(--shadow);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
            position: relative;
        }

        .status-active {
            background: var(--success-color);
            box-shadow: 0 0 10px var(--success-color);
        }

        .status-active::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            border: 1px solid var(--success-color);
            animation: pulse 1.5s infinite;
        }

        .status-inactive {
            background: var(--danger-color);
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-muted);
            font-size: 0.9rem;
            padding: 15px;
            border-top: 1px solid var(--panel-border);
        }

        /* 专业模式特定样式 */
        .pro-mode .channel {
            width: 180px;
            background: rgba(40, 40, 60, 0.9);
        }

        .pro-mode .channel-title {
            color: var(--pro-mode-color);
        }

        .pro-mode .control-label {
            font-size: 0.7rem;
            font-weight: bold;
        }

        .pro-mode .channel-btn {
            font-size: 0.65rem;
            padding: 6px 10px;
        }

        .pro-mode .drop-zone {
            font-size: 0.6rem;
            height: 50px;
        }

        .pro-mode .mic-btn {
            font-size: 0.65rem;
            padding: 6px 10px;
        }

        .pro-mode .fader-thumb {
            background: var(--pro-mode-color);
        }

        .pro-mode .fader-thumb:hover {
            background: #a66bbe;
        }

        /* 新手模式特定样式 */
        .beginner-mode .channel {
            width: 180px;
        }

        .beginner-mode .control-label {
            font-size: 0.8rem;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--primary-color); }
            50% { box-shadow: 0 0 20px var(--primary-color); }
            100% { box-shadow: 0 0 5px var(--primary-color); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .mixer-container {
                flex-direction: column;
            }
            
            .channels-container {
                justify-content: flex-start;
            }
            
            .master-section {
                min-width: 100%;
            }
            
            .music-info-panel {
                flex-direction: column;
                text-align: center;
            }
            
            .music-stats {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .channel {
                width: 150px;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
            
            .mode-selector {
                width: 100%;
                justify-content: center;
            }
            
            .eq-bands {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .eq-band {
                width: 100%;
                max-width: 200px;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .music-cover {
                width: 120px;
                height: 120px;
            }
            
            .music-title {
                font-size: 1.5rem;
            }
            
            .music-stats {
                gap: 15px;
            }
        }

        /* 工具提示 */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* 预设区域 */
        .presets-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
        }

        .presets-title {
            color: var(--text-muted);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .presets-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 5px;
        }

        .preset-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .preset-btn.active {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="app-title">专业音频调音台模拟器</h1>
            <div class="header-controls">
                <div class="mode-selector">
                    <button class="mode-btn active" id="beginner-mode-btn">新手模式</button>
                    <button class="mode-btn" id="pro-mode-btn">专业模式</button>
                </div>
                <div class="language-selector">
                    <i class="fas fa-globe"></i>
                    <select id="language-select">
                        <option value="zh-CN">中文</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- 新增音乐信息面板 -->
        <div class="music-info-panel" id="music-info-panel">
            <div class="music-cover" id="music-cover">
                <i class="fas fa-music"></i>
            </div>
            <div class="music-details">
                <h2 class="music-title" id="music-title">未选择音频</h2>
                <p class="music-artist" id="music-artist">拖放音频文件到任意通道开始混音</p>
                
                <div class="music-stats">
                    <div class="music-stat">
                        <div class="stat-value" id="music-duration">--:--</div>
                        <div class="stat-label">时长</div>
                    </div>
                    <div class="music-stat">
                        <div class="stat-value" id="music-bitrate">---</div>
                        <div class="stat-label">码率</div>
                    </div>
                    <div class="music-stat">
                        <!-- <div class="stat-value" id="music-sample-rate"></div>
                        <div class="stat-label"></div> -->
                    </div>
                    <div class="music-stat">
                        <!-- <div class="stat-value" id="music-channels">--</div>
                        <div class="stat-label">声道</div> -->
                    </div>
                </div>
                
                <div class="music-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="music-progress-fill"></div>
                    </div>
                    <div class="progress-time">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>
                </div>
                
                <div class="music-analysis">
                    <div class="analysis-item">
                        <div class="analysis-value" id="music-bpm">---</div>
                        <div class="analysis-label">BPM</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-value" id="music-key">---</div>
                        <div class="analysis-label">调性</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-value" id="music-loudness">---</div>
                        <div class="analysis-label">响度</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mixer-container beginner-mode" id="mixer-container">
            <div class="channels-section">
                <div class="channels-container" id="channels-container">
                    <!-- 通道将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <div class="master-section">
                <h2 class="master-title" id="master-title">主控</h2>
                <div class="master-controls">
                    <div class="control-group">
                        <div class="control-label" id="master-volume-label">主音量</div>
                        <div class="master-fader">
                            <div class="master-fader-track">
                                <div class="master-fader-thumb" id="master-fader-thumb" style="top: 30%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h3 class="filter-title" id="filter-title">滤波器</h3>
                        <div class="filter-controls">
                            <div class="filter-slider">
                                <label for="filter-freq" id="filter-freq-label">频率:</label>
                                <input type="range" min="20" max="20000" value="1000" id="filter-freq">
                                <span id="filter-freq-value">1000 Hz</span>
                            </div>
                            <div class="filter-slider">
                                <label for="filter-q" id="filter-q-label">Q值:</label>
                                <input type="range" min="0.1" max="10" value="1" step="0.1" id="filter-q">
                                <span id="filter-q-value">1.0</span>
                            </div>
                            <div class="filter-slider">
                                <label for="filter-type" id="filter-type-label">类型:</label>
                                <select id="filter-type">
                                    <option value="lowpass">低通</option>
                                    <option value="highpass">高通</option>
                                    <option value="bandpass">带通</option>
                                    <option value="lowshelf">低架</option>
                                    <option value="highshelf">高架</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="eq-section">
                        <h3 class="eq-title" id="eq-title">均衡器</h3>
                        <div class="eq-bands">
                            <div class="eq-band">
                                <div class="control-label" id="eq-low-label">低频</div>
                                <div class="fader">
                                    <div class="fader-track">
                                        <div class="fader-thumb" id="eq-low-thumb" style="top: 50%;"></div>
                                    </div>
                                </div>
                                <span id="eq-low-value">0 dB</span>
                            </div>
                            <div class="eq-band">
                                <div class="control-label" id="eq-mid-label">中频</div>
                                <div class="fader">
                                    <div class="fader-track">
                                        <div class="fader-thumb" id="eq-mid-thumb" style="top: 50%;"></div>
                                    </div>
                                </div>
                                <span id="eq-mid-value">0 dB</span>
                            </div>
                            <div class="eq-band">
                                <div class="control-label" id="eq-high-label">高频</div>
                                <div class="fader">
                                    <div class="fader-track">
                                        <div class="fader-thumb" id="eq-high-thumb" style="top: 50%;"></div>
                                    </div>
                                </div>
                                <span id="eq-high-value">0 dB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="gain-section">
                        <h3 class="gain-title" id="gain-title">增益</h3>
                        <div class="gain-controls">
                            <div class="gain-slider">
                                <label for="master-gain" id="master-gain-label">增益:</label>
                                <input type="range" min="-20" max="20" value="0" id="master-gain">
                                <span id="master-gain-value">0 dB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="transport-controls">
                        <button class="transport-btn play-btn" id="play-btn">
                            <i class="fas fa-play"></i> <span id="play-btn-text">播放全部</span>
                        </button>
                        <button class="transport-btn stop-btn" id="stop-btn">
                            <i class="fas fa-stop"></i> <span id="stop-btn-text">停止全部</span>
                        </button>
                    </div>

                    <div class="presets-section">
                        <h3 class="presets-title">预设</h3>
                        <div class="presets-container">
                            <button class="preset-btn" data-preset="default">默认</button>
                            <button class="preset-btn" data-preset="bass-boost">低音增强</button>
                            <button class="preset-btn" data-preset="treble-boost">高音增强</button>
                            <button class="preset-btn" data-preset="vocal-enhance">人声增强</button>
                            <button class="preset-btn" data-preset="live-sound">现场音效</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator status-active" id="audio-status"></div>
                <span id="audio-status-text">音频系统: 就绪</span>
            </div>
            <div class="status-item">
                <div class="status-indicator status-inactive" id="playback-status"></div>
                <span id="playback-status-text">播放状态</span>
            </div>
            <div class="status-item">
                <span id="active-channels-label">活动通道: <span id="active-channels">0</span>/8</span>
            </div>
            <div class="status-item">
                <span id="sample-rate-label"></span>
            </div>
        </div>

        <footer>
            <p id="footer-text">专业音频调音台模拟器 &copy; 2025 | 支持多通道混音、均衡器、滤波器和录音功能</p>
        </footer>
    </div>

    <script>
        // 语言资源
        const translations = {
            'zh-CN': {
                'app-title': '专业音频调音台模拟器',
                'beginner-mode': '新手模式',
                'pro-mode': '专业模式',
                'master-title': '主控',
                'master-volume-label': '主音量',
                'filter-title': '滤波器',
                'filter-freq-label': '频率:',
                'filter-q-label': 'Q值:',
                'filter-type-label': '类型:',
                'filter-types': {
                    'lowpass': '低通',
                    'highpass': '高通',
                    'bandpass': '带通',
                    'lowshelf': '低架',
                    'highshelf': '高架'
                },
                'eq-title': '均衡器',
                'eq-low-label': '低频',
                'eq-mid-label': '中频',
                'eq-high-label': '高频',
                'gain-title': '增益',
                'master-gain-label': '增益:',
                'play-btn-text': '播放全部',
                'stop-btn-text': '停止全部',
                'audio-status-text': '音频系统: 就绪',
                'playback-status-text': '播放状态',
                'active-channels-label': '活动通道:',
                'sample-rate-label': '',
                'footer-text': '专业音频调音台模拟器 &copy; 2025 | 支持多通道混音、均衡器、滤波器和录音功能',
                'channel-prefix': '通道',
                'drop-file-text': '拖放文件',
                'mic-btn-text': '麦克风',
                'mic-active-text': '麦克风使用中',
                'mute-btn-text': '静音',
                'solo-btn-text': '独奏',
                'volume-label': '音量',
                'pan-label': '声像',
                'hpf-label': '高通滤波',
                'eq-label': '均衡器',
                'pro-channel-prefix': 'CH',
                'pro-drop-file-text': 'Drop File',
                'pro-mic-btn-text': 'MIC',
                'pro-mic-active-text': 'MIC Active',
                'pro-mute-btn-text': 'MUTE',
                'pro-solo-btn-text': 'SOLO',
                'pro-control-labels': {
                    'HPF': 'HPF',
                    'GATE': 'GATE',
                    'COMP': 'COMP',
                    'EQ_LOW': 'EQ LOW',
                    'EQ_MID': 'EQ MID',
                    'EQ_HIGH': 'EQ HIGH',
                    'PAN': 'PAN',
                    'FADER': 'FADER'
                },
                'presets-title': '预设',
                'preset-default': '默认',
                'preset-bass-boost': '低音增强',
                'preset-treble-boost': '高音增强',
                'preset-vocal-enhance': '人声增强',
                'preset-live-sound': '现场音效',
                'music-no-file': '未选择音频',
                'music-drop-hint': '拖放音频文件到任意通道开始混音',
                'music-duration': '时长',
                'music-bitrate': '码率',
                'music-sample-rate': '采样率',
                'music-channels': '声道',
                'music-bpm': 'BPM',
                'music-key': '调性',
                'music-loudness': '响度'
            },
            'en': {
                'app-title': 'Professional Audio Mixer Simulator',
                'beginner-mode': 'Beginner Mode',
                'pro-mode': 'Pro Mode',
                'master-title': 'Master',
                'master-volume-label': 'Master Volume',
                'filter-title': 'Filter',
                'filter-freq-label': 'Freq:',
                'filter-q-label': 'Q:',
                'filter-type-label': 'Type:',
                'filter-types': {
                    'lowpass': 'Lowpass',
                    'highpass': 'Highpass',
                    'bandpass': 'Bandpass',
                    'lowshelf': 'Lowshelf',
                    'highshelf': 'Highshelf'
                },
                'eq-title': 'Equalizer',
                'eq-low-label': 'Low',
                'eq-mid-label': 'Mid',
                'eq-high-label': 'High',
                'gain-title': 'Gain',
                'master-gain-label': 'Gain:',
                'play-btn-text': 'Play All',
                'stop-btn-text': 'Stop All',
                'audio-status-text': 'Audio System: Ready',
                'playback-status-text': 'Playback',
                'active-channels-label': 'Active Channels:',
                'sample-rate-label': 'Sample Rate: 44.1kHz',
                'footer-text': 'Professional Audio Mixer Simulator &copy; 2025 | Supports multi-channel mixing, EQ, filters and recording',
                'channel-prefix': 'Channel',
                'drop-file-text': 'Drop File',
                'mic-btn-text': 'Microphone',
                'mic-active-text': 'Mic Active',
                'mute-btn-text': 'Mute',
                'solo-btn-text': 'Solo',
                'volume-label': 'Volume',
                'pan-label': 'Pan',
                'hpf-label': 'HPF',
                'eq-label': 'EQ',
                'pro-channel-prefix': 'CH',
                'pro-drop-file-text': 'Drop File',
                'pro-mic-btn-text': 'MIC',
                'pro-mic-active-text': 'MIC Active',
                'pro-mute-btn-text': 'MUTE',
                'pro-solo-btn-text': 'SOLO',
                'pro-control-labels': {
                    'HPF': 'HPF',
                    'GATE': 'GATE',
                    'COMP': 'COMP',
                    'EQ_LOW': 'EQ LOW',
                    'EQ_MID': 'EQ MID',
                    'EQ_HIGH': 'EQ HIGH',
                    'PAN': 'PAN',
                    'FADER': 'FADER'
                },
                'presets-title': 'Presets',
                'preset-default': 'Default',
                'preset-bass-boost': 'Bass Boost',
                'preset-treble-boost': 'Treble Boost',
                'preset-vocal-enhance': 'Vocal Enhance',
                'preset-live-sound': 'Live Sound',
                'music-no-file': 'No Audio Selected',
                'music-drop-hint': 'Drop audio files to any channel to start mixing',
                'music-duration': 'Duration',
                'music-bitrate': 'Bitrate',
                'music-sample-rate': 'Sample Rate',
                'music-channels': 'Channels',
                'music-bpm': 'BPM',
                'music-key': 'Key',
                'music-loudness': 'Loudness'
            }
        };

        // 全局变量
        let audioContext;
        let masterGainNode;
        let filterNode;
        let eqLowNode, eqMidNode, eqHighNode;
        let isPlaying = false;
        let channels = {};
        let currentMode = 'beginner';
        let currentLanguage = 'zh-CN';
        let currentMusicInfo = null;
        
        // 初始化音频上下文
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 创建主增益节点
                masterGainNode = audioContext.createGain();
                masterGainNode.gain.value = 0.8;
                
                // 创建滤波器
                filterNode = audioContext.createBiquadFilter();
                filterNode.type = 'lowpass';
                filterNode.frequency.value = 1000;
                filterNode.Q.value = 1;
                
                // 创建EQ节点
                eqLowNode = audioContext.createBiquadFilter();
                eqLowNode.type = 'lowshelf';
                eqLowNode.frequency.value = 250;
                eqLowNode.gain.value = 0;
                
                eqMidNode = audioContext.createBiquadFilter();
                eqMidNode.type = 'peaking';
                eqMidNode.frequency.value = 1000;
                eqMidNode.Q.value = 1;
                eqMidNode.gain.value = 0;
                
                eqHighNode = audioContext.createBiquadFilter();
                eqHighNode.type = 'highshelf';
                eqHighNode.frequency.value = 4000;
                eqHighNode.gain.value = 0;
                
                // 连接节点: 滤波器 -> EQ -> 主增益 -> 输出
                filterNode.connect(eqLowNode);
                eqLowNode.connect(eqMidNode);
                eqMidNode.connect(eqHighNode);
                eqHighNode.connect(masterGainNode);
                masterGainNode.connect(audioContext.destination);
                
                // 初始化所有通道
                for (let i = 1; i <= 8; i++) {
                    const channelId = `ch${i}`;
                    channels[channelId] = {
                        audioBuffer: null,
                        source: null,
                        gainNode: null,
                        panNode: null,
                        analyser: null,
                        isMuted: false,
                        isSolo: false,
                        isPlaying: false,
                        isMic: false,
                        file: null,
                        eqLowNode: null,
                        eqMidNode: null,
                        eqHighNode: null,
                        filterNode: null,
                        meterPeak: 0
                    };
                    
                    // 创建分析器用于电平表
                    channels[channelId].analyser = audioContext.createAnalyser();
                    channels[channelId].analyser.fftSize = 256;
                    
                    // 创建通道EQ节点
                    channels[channelId].eqLowNode = audioContext.createBiquadFilter();
                    channels[channelId].eqLowNode.type = 'lowshelf';
                    channels[channelId].eqLowNode.frequency.value = 250;
                    channels[channelId].eqLowNode.gain.value = 0;
                    
                    channels[channelId].eqMidNode = audioContext.createBiquadFilter();
                    channels[channelId].eqMidNode.type = 'peaking';
                    channels[channelId].eqMidNode.frequency.value = 1000;
                    channels[channelId].eqMidNode.Q.value = 1;
                    channels[channelId].eqMidNode.gain.value = 0;
                    
                    channels[channelId].eqHighNode = audioContext.createBiquadFilter();
                    channels[channelId].eqHighNode.type = 'highshelf';
                    channels[channelId].eqHighNode.frequency.value = 4000;
                    channels[channelId].eqHighNode.gain.value = 0;
                    
                    // 创建通道滤波器
                    channels[channelId].filterNode = audioContext.createBiquadFilter();
                    channels[channelId].filterNode.type = 'lowpass';
                    channels[channelId].filterNode.frequency.value = 1000;
                    channels[channelId].filterNode.Q.value = 1;
                }
                
                updateAudioStatus(true, translations[currentLanguage]['audio-status-text']);
                console.log("音频系统初始化成功");
                
                // 初始化主控推子
                initMasterFader();
                
                // 初始化滤波器控制
                initFilterControls();
                
                // 初始化EQ控制
                initEQControls();
                
                // 初始化增益控制
                initGainControls();
                
                // 初始化预设
                initPresets();
                
                // 初始化音乐信息面板
                updateMusicInfoPanel();
            } catch (error) {
                console.error("音频系统初始化失败:", error);
                updateAudioStatus(false, translations[currentLanguage]['audio-status-text']);
            }
        }

        // 更新音乐信息面板
        function updateMusicInfoPanel(musicInfo = null) {
            const title = document.getElementById('music-title');
            const artist = document.getElementById('music-artist');
            const duration = document.getElementById('music-duration');
            const bitrate = document.getElementById('music-bitrate');
            const sampleRate = document.getElementById('music-sample-rate');
            const channels = document.getElementById('music-channels');
            const bpm = document.getElementById('music-bpm');
            const key = document.getElementById('music-key');
            const loudness = document.getElementById('music-loudness');
            const progressFill = document.getElementById('music-progress-fill');
            const currentTime = document.getElementById('current-time');
            const totalTime = document.getElementById('total-time');
            
            if (!musicInfo) {
                title.textContent = translations[currentLanguage]['music-no-file'];
                artist.textContent = translations[currentLanguage]['music-drop-hint'];
                duration.textContent = '--:--';
                bitrate.textContent = '---';
                sampleRate.textContent = '';
                channels.textContent = '--';
                bpm.textContent = '---';
                key.textContent = '---';
                loudness.textContent = '---';
                progressFill.style.width = '0%';
                currentTime.textContent = '0:00';
                totalTime.textContent = '0:00';
                return;
            }
            
            title.textContent = musicInfo.title || musicInfo.filename || '未知标题';
            artist.textContent = musicInfo.artist || '未知艺术家';
            duration.textContent = formatTime(musicInfo.duration || 0);
            bitrate.textContent = musicInfo.bitrate || '---';
            sampleRate.textContent = musicInfo.sampleRate || '';
            channels.textContent = musicInfo.channels || '--';
            bpm.textContent = musicInfo.bpm || '---';
            key.textContent = musicInfo.key || '---';
            loudness.textContent = musicInfo.loudness || '---';
            progressFill.style.width = '0%';
            currentTime.textContent = '0:00';
            totalTime.textContent = formatTime(musicInfo.duration || 0);
            
            // 如果有封面图片，更新封面
            if (musicInfo.cover) {
                const cover = document.getElementById('music-cover');
                cover.innerHTML = '';
                const img = document.createElement('img');
                img.src = musicInfo.cover;
                img.alt = '专辑封面';
                cover.appendChild(img);
            }
        }

        // 格式化时间（秒 -> 分:秒）
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // 初始化主控推子
        function initMasterFader() {
            const faderThumb = document.getElementById('master-fader-thumb');
            const track = document.querySelector('.master-fader-track');
            
            let isDragging = false;
            
            const updateThumbPosition = (y) => {
                const trackRect = track.getBoundingClientRect();
                let newTop = y - trackRect.top;
                
                // 限制在轨道范围内
                newTop = Math.max(0, Math.min(newTop, trackRect.height));
                
                // 更新拇指位置
                faderThumb.style.top = `${newTop}px`;
                
                // 计算值（0-1）
                const value = 1 - (newTop / trackRect.height);
                
                // 更新主增益
                masterGainNode.gain.value = value;
            };
            
            faderThumb.addEventListener('mousedown', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    updateThumbPosition(e.clientY);
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            track.addEventListener('click', (e) => {
                updateThumbPosition(e.clientY);
            });
        }

        // 初始化滤波器控制
        function initFilterControls() {
            const filterFreq = document.getElementById('filter-freq');
            const filterQ = document.getElementById('filter-q');
            const filterType = document.getElementById('filter-type');
            const filterFreqValue = document.getElementById('filter-freq-value');
            const filterQValue = document.getElementById('filter-q-value');
            
            filterFreq.addEventListener('input', (e) => {
                filterNode.frequency.value = e.target.value;
                filterFreqValue.textContent = `${e.target.value} Hz`;
            });
            
            filterQ.addEventListener('input', (e) => {
                filterNode.Q.value = e.target.value;
                filterQValue.textContent = e.target.value;
            });
            
            filterType.addEventListener('change', (e) => {
                filterNode.type = e.target.value;
                updateFilterTypeOptions();
            });
        }

        // 更新滤波器类型选项
        function updateFilterTypeOptions() {
            const filterType = document.getElementById('filter-type');
            const options = filterType.querySelectorAll('option');
            
            options.forEach(option => {
                option.textContent = translations[currentLanguage]['filter-types'][option.value];
            });
        }

        // 初始化EQ控制
        function initEQControls() {
            const eqLowThumb = document.getElementById('eq-low-thumb');
            const eqMidThumb = document.getElementById('eq-mid-thumb');
            const eqHighThumb = document.getElementById('eq-high-thumb');
            const eqLowValue = document.getElementById('eq-low-value');
            const eqMidValue = document.getElementById('eq-mid-value');
            const eqHighValue = document.getElementById('eq-high-value');
            
            // 低频EQ控制
            initEQFader(eqLowThumb, eqLowNode, eqLowValue, -20, 20);
            
            // 中频EQ控制
            initEQFader(eqMidThumb, eqMidNode, eqMidValue, -20, 20);
            
            // 高频EQ控制
            initEQFader(eqHighThumb, eqHighNode, eqHighValue, -20, 20);
        }
        
        // 初始化EQ推子
        function initEQFader(thumb, node, valueDisplay, min, max) {
            const track = thumb.parentElement;
            
            let isDragging = false;
            
            const updateThumbPosition = (y) => {
                const trackRect = track.getBoundingClientRect();
                let newTop = y - trackRect.top;
                
                // 限制在轨道范围内
                newTop = Math.max(0, Math.min(newTop, trackRect.height));
                
                // 更新拇指位置
                thumb.style.top = `${newTop}px`;
                
                // 计算值（min-max）
                const valueRange = max - min;
                const value = min + (valueRange * (1 - (newTop / trackRect.height)));
                
                // 更新EQ节点增益
                node.gain.value = value;
                
                // 更新显示值
                valueDisplay.textContent = `${value > 0 ? '+' : ''}${value.toFixed(1)} dB`;
            };
            
            thumb.addEventListener('mousedown', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    updateThumbPosition(e.clientY);
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            track.addEventListener('click', (e) => {
                updateThumbPosition(e.clientY);
            });
        }

        // 初始化增益控制
        function initGainControls() {
            const masterGain = document.getElementById('master-gain');
            const masterGainValue = document.getElementById('master-gain-value');
            
            masterGain.addEventListener('input', (e) => {
                const db = parseInt(e.target.value);
                masterGainValue.textContent = `${db > 0 ? '+' : ''}${db} dB`;
                
                // 将dB值转换为线性增益值
                const linearGain = Math.pow(10, db / 20);
                masterGainNode.gain.value = linearGain;
            });
        }

        // 初始化预设
        function initPresets() {
            const presetButtons = document.querySelectorAll('.preset-btn');
            
            presetButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const preset = e.target.getAttribute('data-preset');
                    applyPreset(preset);
                    
                    // 更新激活状态
                    presetButtons.forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });
        }

        // 应用预设
        function applyPreset(preset) {
            switch(preset) {
                case 'default':
                    // 重置所有设置
                    filterNode.frequency.value = 1000;
                    filterNode.Q.value = 1;
                    filterNode.type = 'lowpass';
                    eqLowNode.gain.value = 0;
                    eqMidNode.gain.value = 0;
                    eqHighNode.gain.value = 0;
                    masterGainNode.gain.value = 0.8;
                    
                    // 更新UI
                    document.getElementById('filter-freq').value = 1000;
                    document.getElementById('filter-freq-value').textContent = '1000 Hz';
                    document.getElementById('filter-q').value = 1;
                    document.getElementById('filter-q-value').textContent = '1.0';
                    document.getElementById('filter-type').value = 'lowpass';
                    document.getElementById('eq-low-value').textContent = '0 dB';
                    document.getElementById('eq-mid-value').textContent = '0 dB';
                    document.getElementById('eq-high-value').textContent = '0 dB';
                    document.getElementById('master-gain').value = 0;
                    document.getElementById('master-gain-value').textContent = '0 dB';
                    
                    // 重置推子位置
                    document.getElementById('eq-low-thumb').style.top = '50%';
                    document.getElementById('eq-mid-thumb').style.top = '50%';
                    document.getElementById('eq-high-thumb').style.top = '50%';
                    break;
                    
                case 'bass-boost':
                    eqLowNode.gain.value = 8;
                    eqMidNode.gain.value = 0;
                    eqHighNode.gain.value = 0;
                    
                    document.getElementById('eq-low-value').textContent = '+8.0 dB';
                    document.getElementById('eq-mid-value').textContent = '0 dB';
                    document.getElementById('eq-high-value').textContent = '0 dB';
                    
                    document.getElementById('eq-low-thumb').style.top = '30%';
                    document.getElementById('eq-mid-thumb').style.top = '50%';
                    document.getElementById('eq-high-thumb').style.top = '50%';
                    break;
                    
                case 'treble-boost':
                    eqLowNode.gain.value = 0;
                    eqMidNode.gain.value = 0;
                    eqHighNode.gain.value = 8;
                    
                    document.getElementById('eq-low-value').textContent = '0 dB';
                    document.getElementById('eq-mid-value').textContent = '0 dB';
                    document.getElementById('eq-high-value').textContent = '+8.0 dB';
                    
                    document.getElementById('eq-low-thumb').style.top = '50%';
                    document.getElementById('eq-mid-thumb').style.top = '50%';
                    document.getElementById('eq-high-thumb').style.top = '30%';
                    break;
                    
                case 'vocal-enhance':
                    eqLowNode.gain.value = 2;
                    eqMidNode.gain.value = 4;
                    eqHighNode.gain.value = 3;
                    
                    document.getElementById('eq-low-value').textContent = '+2.0 dB';
                    document.getElementById('eq-mid-value').textContent = '+4.0 dB';
                    document.getElementById('eq-high-value').textContent = '+3.0 dB';
                    
                    document.getElementById('eq-low-thumb').style.top = '45%';
                    document.getElementById('eq-mid-thumb').style.top = '35%';
                    document.getElementById('eq-high-thumb').style.top = '40%';
                    break;
                    
                case 'live-sound':
                    filterNode.frequency.value = 8000;
                    filterNode.type = 'highshelf';
                    eqLowNode.gain.value = 3;
                    eqMidNode.gain.value = 1;
                    eqHighNode.gain.value = 4;
                    
                    document.getElementById('filter-freq').value = 8000;
                    document.getElementById('filter-freq-value').textContent = '8000 Hz';
                    document.getElementById('filter-type').value = 'highshelf';
                    document.getElementById('eq-low-value').textContent = '+3.0 dB';
                    document.getElementById('eq-mid-value').textContent = '+1.0 dB';
                    document.getElementById('eq-high-value').textContent = '+4.0 dB';
                    
                    document.getElementById('eq-low-thumb').style.top = '42%';
                    document.getElementById('eq-mid-thumb').style.top = '47%';
                    document.getElementById('eq-high-thumb').style.top = '38%';
                    break;
            }
            
            updateFilterTypeOptions();
        }

        // 更新音频状态
        function updateAudioStatus(active, text) {
            const statusIndicator = document.getElementById('audio-status');
            const statusText = document.getElementById('audio-status-text');
            
            if (active) {
                statusIndicator.className = 'status-indicator status-active';
            } else {
                statusIndicator.className = 'status-indicator status-inactive';
            }
            
            statusText.textContent = text;
        }

        // 生成通道HTML
        function generateChannels() {
            const channelsContainer = document.getElementById('channels-container');
            channelsContainer.innerHTML = '';
            
            for (let i = 1; i <= 8; i++) {
                const channelId = `ch${i}`;
                const channelHTML = `
                    <div class="channel" id="${channelId}">
                        <div class="channel-header">
                            <div class="channel-title">${currentMode === 'pro' ? translations[currentLanguage]['pro-channel-prefix'] : translations[currentLanguage]['channel-prefix']} ${i}</div>
                            <div class="channel-meter">
                                <div class="channel-meter-level" id="meter-${channelId}"></div>
                                <div class="channel-meter-peak" id="meter-peak-${channelId}"></div>
                            </div>
                        </div>
                        <div class="input-source">
                            <div class="drop-zone" data-channel="${channelId}">
                                <div class="file-icon">📁</div>
                                <p>${currentMode === 'pro' ? translations[currentLanguage]['pro-drop-file-text'] : translations[currentLanguage]['drop-file-text']}</p>
                            </div>
                            <button class="mic-btn" data-channel="${channelId}">${currentMode === 'pro' ? translations[currentLanguage]['pro-mic-btn-text'] : translations[currentLanguage]['mic-btn-text']}</button>
                        </div>
                        <div class="channel-controls">
                            ${currentMode === 'pro' ? `
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['HPF']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 80%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['GATE']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 70%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['COMP']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 60%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['EQ_LOW']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 50%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['EQ_MID']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 50%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['EQ_HIGH']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 50%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['PAN']}</div>
                                    <div class="knob">
                                        <div class="knob-dial">
                                            <div class="knob-indicator" style="transform: translateX(-50%) rotate(0deg);"></div>
                                        </div>
                                        <div class="knob-value">0</div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pro-control-labels']['FADER']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 70%;"></div>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['volume-label']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 70%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['pan-label']}</div>
                                    <div class="knob">
                                        <div class="knob-dial">
                                            <div class="knob-indicator" style="transform: translateX(-50%) rotate(0deg);"></div>
                                        </div>
                                        <div class="knob-value">0</div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['hpf-label']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 80%;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="control-label">${translations[currentLanguage]['eq-label']}</div>
                                    <div class="fader">
                                        <div class="fader-track">
                                            <div class="fader-thumb" style="top: 50%;"></div>
                                        </div>
                                    </div>
                                </div>
                            `}
                            <div class="button-group">
                                <button class="channel-btn" data-channel="${channelId}" data-action="mute">
                                    ${currentMode === 'pro' ? translations[currentLanguage]['pro-mute-btn-text'] : translations[currentLanguage]['mute-btn-text']}
                                </button>
                                <button class="channel-btn" data-channel="${channelId}" data-action="solo">
                                    ${currentMode === 'pro' ? translations[currentLanguage]['pro-solo-btn-text'] : translations[currentLanguage]['solo-btn-text']}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                channelsContainer.innerHTML += channelHTML;
            }
            
            // 添加通道按钮事件监听器
            document.querySelectorAll('.channel-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const channel = e.target.getAttribute('data-channel');
                    const action = e.target.getAttribute('data-action');
                    
                    handleChannelAction(channel, action, e.target);
                });
            });
            
            // 添加文件拖放功能
            initDragAndDrop();
            
            // 添加麦克风按钮事件
            initMicButtons();
            
            // 添加推子拖动功能
            initFaders();
            
            // 添加旋钮控制功能
            initKnobs();
        }

        // 初始化文件拖放功能
        function initDragAndDrop() {
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.style.backgroundColor = '';
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.style.backgroundColor = '';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const channel = zone.getAttribute('data-channel');
                        handleFileUpload(files[0], channel);
                    }
                });
                
                // 点击上传
                zone.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'BUTTON') {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = 'audio/*';
                        input.onchange = (e) => {
                            const files = e.target.files;
                            if (files.length > 0) {
                                const channel = zone.getAttribute('data-channel');
                                handleFileUpload(files[0], channel);
                            }
                        };
                        input.click();
                    }
                });
            });
        }

        // 处理文件上传
        function handleFileUpload(file, channel) {
            if (!file.type.match('audio.*')) {
                alert('请选择音频文件！');
                return;
            }
            
            // 更新UI显示文件已加载
            const dropZone = document.querySelector(`.drop-zone[data-channel="${channel}"]`);
            dropZone.innerHTML = `<div class="file-icon">✅</div><p>${file.name.substring(0, 10)}...</p>`;
            
            // 创建对象URL用于播放
            const objectUrl = URL.createObjectURL(file);
            
            // 使用Audio元素解码
            const audio = new Audio();
            audio.src = objectUrl;
            
            // 使用OfflineAudioContext解码音频
            const reader = new FileReader();
            reader.onload = function(e) {
                audioContext.decodeAudioData(e.target.result, function(buffer) {
                    channels[channel].audioBuffer = buffer;
                    channels[channel].isMic = false;
                    channels[channel].file = file;
                    
                    // 提取音乐信息并更新面板
                    extractMusicInfo(file, buffer, channel);
                    
                    updateActiveChannels();
                    console.log(`音频已加载到 ${channel}`);
                }, function(e) {
                    console.error("解码音频数据时出错", e);
                });
            };
            reader.readAsArrayBuffer(file);
        }

        // 提取音乐信息
        function extractMusicInfo(file, buffer, channel) {
            // 从文件名中提取标题和艺术家信息（简化处理）
            const fileName = file.name.replace(/\.[^/.]+$/, ""); // 移除扩展名
            let title = fileName;
            let artist = "未知艺术家";
            
            // 简单的文件名解析（假设格式为 "艺术家 - 标题" 或 "标题"）
            if (fileName.includes(" - ")) {
                const parts = fileName.split(" - ");
                artist = parts[0];
                title = parts[1] || title;
            }
            
            // 计算音频属性
            const duration = buffer.duration;
            const sampleRate = buffer.sampleRate;
            const channels = buffer.numberOfChannels;
            
            // 计算比特率（简化计算）
            const fileSizeMB = file.size / (1024 * 1024);
            const durationMinutes = duration / 60;
            const bitrate = fileSizeMB > 0 && durationMinutes > 0 ? 
                Math.round((fileSizeMB * 8) / durationMinutes) + ' kbps' : '---';
            
            // 创建音乐信息对象
            const musicInfo = {
                filename: file.name,
                title: title,
                artist: artist,
                duration: duration,
                bitrate: bitrate,
                sampleRate: (sampleRate / 1000).toFixed(1) + 'kHz',
                channels: channels,
                bpm: '---', // 实际BPM检测需要复杂算法
                key: '---', // 实际调性检测需要复杂算法
                loudness: '---', // 实际响度检测需要复杂算法
                cover: null // 在实际应用中，可以从ID3标签提取封面
            };
            
            currentMusicInfo = musicInfo;
            updateMusicInfoPanel(musicInfo);
            
            // 尝试分析音频特征
            analyzeAudioFeatures(buffer, musicInfo);
        }

        // 分析音频特征
        function analyzeAudioFeatures(buffer, musicInfo) {
            try {
                // 获取音频数据
                const channelData = buffer.getChannelData(0); // 使用第一个声道
                const sampleRate = buffer.sampleRate;
                
                // 计算响度（RMS）
                let sum = 0;
                for (let i = 0; i < channelData.length; i++) {
                    sum += channelData[i] * channelData[i];
                }
                const rms = Math.sqrt(sum / channelData.length);
                const loudnessDb = 20 * Math.log10(rms);
                musicInfo.loudness = loudnessDb.toFixed(1) + ' dB';
                
                // 简单的频谱分析
                const analyser = audioContext.createAnalyser();
                const bufferSource = audioContext.createBufferSource();
                bufferSource.buffer = buffer;
                bufferSource.connect(analyser);
                
                analyser.fftSize = 2048;
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                // 获取频率数据
                analyser.getByteFrequencyData(dataArray);
                
                // 计算频谱重心（粗略的频率分布指示）
                let total = 0;
                let weightedSum = 0;
                for (let i = 0; i < bufferLength; i++) {
                    weightedSum += i * dataArray[i];
                    total += dataArray[i];
                }
                
                const spectralCentroid = total > 0 ? weightedSum / total : 0;
                
                // 根据频谱重心给出粗略的调性提示
                if (spectralCentroid < bufferLength * 0.25) {
                    musicInfo.key = '低音域';
                } else if (spectralCentroid < bufferLength * 0.5) {
                    musicInfo.key = '中音域';
                } else {
                    musicInfo.key = '高音域';
                }
                
                // 更新音乐信息面板
                updateMusicInfoPanel(musicInfo);
                
                // 清理资源
                bufferSource.disconnect();
                
            } catch (error) {
                console.error("音频特征分析失败:", error);
            }
        }

        // 初始化麦克风按钮
        function initMicButtons() {
            document.querySelectorAll('.mic-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const channel = e.target.getAttribute('data-channel');
                    if (channels[channel].isMic && channels[channel].isPlaying) {
                        stopChannel(channel);
                        e.target.classList.remove('active');
                        const dropZone = document.querySelector(`.drop-zone[data-channel="${channel}"]`);
                        dropZone.innerHTML = `<div class="file-icon">📁</div><p>${currentMode === 'pro' ? translations[currentLanguage]['pro-drop-file-text'] : translations[currentLanguage]['drop-file-text']}</p>`;
                        channels[channel].isMic = false;
                        
                        // 清除音乐信息
                        updateMusicInfoPanel();
                    } else {
                        initMicrophone(channel);
                        e.target.classList.add('active');
                    }
                    updateActiveChannels();
                });
            });
        }

        // 初始化麦克风输入
        function initMicrophone(channel) {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const source = audioContext.createMediaStreamSource(stream);
                    const gainNode = audioContext.createGain();
                    const panNode = audioContext.createStereoPanner();
                    
                    // 设置初始值
                    gainNode.gain.value = 0.7;
                    panNode.pan.value = 0;
                    
                    // 连接节点: 源 -> 通道EQ -> 通道滤波器 -> 声像 -> 增益 -> 分析器 -> 主控
                    source.connect(channels[channel].eqLowNode);
                    channels[channel].eqLowNode.connect(channels[channel].eqMidNode);
                    channels[channel].eqMidNode.connect(channels[channel].eqHighNode);
                    channels[channel].eqHighNode.connect(channels[channel].filterNode);
                    channels[channel].filterNode.connect(panNode);
                    panNode.connect(gainNode);
                    gainNode.connect(channels[channel].analyser);
                    channels[channel].analyser.connect(filterNode);
                    
                    channels[channel].source = source;
                    channels[channel].gainNode = gainNode;
                    channels[channel].panNode = panNode;
                    channels[channel].isPlaying = true;
                    channels[channel].isMic = true;
                    
                    // 更新UI
                    const dropZone = document.querySelector(`.drop-zone[data-channel="${channel}"]`);
                    dropZone.innerHTML = `<div class="file-icon">🎤</div><p>${currentMode === 'pro' ? translations[currentLanguage]['pro-mic-active-text'] : translations[currentLanguage]['mic-active-text']}</p>`;
                    
                    // 更新音乐信息面板显示麦克风信息
                    const micInfo = {
                        title: '麦克风输入',
                        artist: '实时音频',
                        duration: 0,
                        bitrate: '---',
                        sampleRate: '44.1kHz',
                        channels: 1,
                        bpm: '---',
                        key: '---',
                        loudness: '---'
                    };
                    updateMusicInfoPanel(micInfo);
                    
                    updatePlaybackStatus();
                    console.log(`麦克风连接到 ${channel}`);
                })
                .catch(error => {
                    console.error('访问麦克风时出错:', error);
                    alert('无法访问麦克风。请确保已授予麦克风权限。');
                });
            } else {
                console.error('getUserMedia 不支持');
                alert('您的浏览器不支持麦克风访问。');
            }
        }

        // 处理通道按钮动作
        function handleChannelAction(channel, action, button) {
            switch(action) {
                case 'mute':
                    channels[channel].isMuted = !channels[channel].isMuted;
                    button.classList.toggle('active', channels[channel].isMuted);
                    if (channels[channel].gainNode) {
                        channels[channel].gainNode.gain.value = channels[channel].isMuted ? 0 : 0.7;
                    }
                    break;
                case 'solo':
                    channels[channel].isSolo = !channels[channel].isSolo;
                    button.classList.toggle('active', channels[channel].isSolo);
                    // 实现独奏逻辑（简化版）
                    Object.keys(channels).forEach(ch => {
                        if (ch !== channel && channels[ch].gainNode) {
                            channels[ch].gainNode.gain.value = channels[channel].isSolo ? 0 : 0.7;
                        }
                    });
                    break;
            }
        }

        // 初始化推子拖动功能
        function initFaders() {
            document.querySelectorAll('.fader').forEach(fader => {
                const track = fader.querySelector('.fader-track');
                const thumb = fader.querySelector('.fader-thumb');
                const channelElement = fader.closest('.channel');
                
                if (!channelElement) return; // 跳过主控部分的推子
                
                const channelId = channelElement.id;
                
                let isDragging = false;
                
                const updateThumbPosition = (y) => {
                    const trackRect = track.getBoundingClientRect();
                    let newTop = y - trackRect.top;
                    
                    // 限制在轨道范围内
                    newTop = Math.max(0, Math.min(newTop, trackRect.height));
                    
                    // 更新拇指位置
                    thumb.style.top = `${newTop}px`;
                    
                    // 计算值（0-1）
                    const value = 1 - (newTop / trackRect.height);
                    
                    // 更新对应通道的音量
                    if (channels[channelId].gainNode) {
                        channels[channelId].gainNode.gain.value = value;
                    }
                };
                
                thumb.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    e.preventDefault();
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        updateThumbPosition(e.clientY);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                track.addEventListener('click', (e) => {
                    updateThumbPosition(e.clientY);
                });
            });
        }

        // 初始化旋钮控制
        function initKnobs() {
            document.querySelectorAll('.knob').forEach(knob => {
                const dial = knob.querySelector('.knob-dial');
                const indicator = knob.querySelector('.knob-indicator');
                const valueDisplay = knob.querySelector('.knob-value');
                const channelElement = knob.closest('.channel');
                
                if (!channelElement) return; // 跳过主控部分的旋钮
                
                const channelId = channelElement.id;
                
                let isDragging = false;
                let currentRotation = 0; // -150 到 150 度
                
                const updateRotation = (clientX, clientY) => {
                    const knobRect = dial.getBoundingClientRect();
                    const centerX = knobRect.left + knobRect.width / 2;
                    const centerY = knobRect.top + knobRect.height / 2;
                    
                    const deltaX = clientX - centerX;
                    const deltaY = clientY - centerY;
                    
                    // 计算角度
                    let angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                    
                    // 限制在 -150 到 150 度范围内
                    if (angle < -150) angle = -150;
                    if (angle > 150) angle = 150;
                    
                    currentRotation = angle;
                    
                    // 更新指示器位置
                    indicator.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                    
                    // 计算声像值 (-1 到 1)
                    const panValue = angle / 150;
                    
                    // 更新显示值
                    if (valueDisplay) {
                        valueDisplay.textContent = panValue.toFixed(1);
                    }
                    
                    // 更新对应通道的声像
                    if (channels[channelId].panNode) {
                        channels[channelId].panNode.pan.value = panValue;
                    }
                };
                
                dial.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    e.preventDefault();
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        updateRotation(e.clientX, e.clientY);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                // 点击旋钮直接设置位置
                dial.addEventListener('click', (e) => {
                    updateRotation(e.clientX, e.clientY);
                });
            });
        }

        // 更新活动通道计数
        function updateActiveChannels() {
            let activeCount = 0;
            for (let i = 1; i <= 8; i++) {
                const channelId = `ch${i}`;
                if (channels[channelId].audioBuffer || channels[channelId].isMic) {
                    activeCount++;
                }
            }
            document.getElementById('active-channels').textContent = activeCount;
        }

        // 更新电平表
        function updateMeters() {
            for (let i = 1; i <= 8; i++) {
                const channelId = `ch${i}`;
                const meter = document.getElementById(`meter-${channelId}`);
                const peakMeter = document.getElementById(`meter-peak-${channelId}`);
                
                if (channels[channelId].isPlaying && channels[channelId].analyser) {
                    const dataArray = new Uint8Array(channels[channelId].analyser.frequencyBinCount);
                    channels[channelId].analyser.getByteFrequencyData(dataArray);
                    
                    // 计算平均音量
                    let sum = 0;
                    for (let j = 0; j < dataArray.length; j++) {
                        sum += dataArray[j];
                    }
                    const average = sum / dataArray.length;
                    
                    // 转换为百分比
                    const level = Math.min(100, (average / 256) * 100);
                    
                    // 更新电平表
                    meter.style.height = `${level}%`;
                    
                    // 更新峰值
                    if (level > channels[channelId].meterPeak) {
                        channels[channelId].meterPeak = level;
                    } else {
                        // 缓慢下降峰值
                        channels[channelId].meterPeak = Math.max(level, channels[channelId].meterPeak - 0.5);
                    }
                    
                    // 更新峰值指示器
                    peakMeter.style.bottom = `${channels[channelId].meterPeak}%`;
                } else {
                    meter.style.height = '0%';
                    channels[channelId].meterPeak = 0;
                    peakMeter.style.bottom = '0%';
                }
            }
            
            requestAnimationFrame(updateMeters);
        }

        // 播放/停止音频
        function playAllChannels() {
            if (isPlaying) return;
            
            Object.keys(channels).forEach(channel => {
                if (!channels[channel].isPlaying && channels[channel].audioBuffer) {
                    // 创建音频源
                    const source = audioContext.createBufferSource();
                    source.buffer = channels[channel].audioBuffer;
                    source.loop = true;
                    
                    // 创建增益节点
                    const gainNode = audioContext.createGain();
                    gainNode.gain.value = channels[channel].isMuted ? 0 : 0.7;
                    
                    // 创建声像节点
                    const panNode = audioContext.createStereoPanner();
                    panNode.pan.value = 0;
                    
                    // 连接节点: 源 -> 通道EQ -> 通道滤波器 -> 声像 -> 增益 -> 分析器 -> 主控
                    source.connect(channels[channel].eqLowNode);
                    channels[channel].eqLowNode.connect(channels[channel].eqMidNode);
                    channels[channel].eqMidNode.connect(channels[channel].eqHighNode);
                    channels[channel].eqHighNode.connect(channels[channel].filterNode);
                    channels[channel].filterNode.connect(panNode);
                    panNode.connect(gainNode);
                    gainNode.connect(channels[channel].analyser);
                    channels[channel].analyser.connect(filterNode);
                    
                    // 保存引用
                    channels[channel].source = source;
                    channels[channel].gainNode = gainNode;
                    channels[channel].panNode = panNode;
                    channels[channel].isPlaying = true;
                    
                    // 开始播放
                    source.start();
                }
            });
            
            isPlaying = true;
            updatePlaybackStatus();
        }

        function stopAllChannels() {
            Object.keys(channels).forEach(channel => {
                if (channels[channel].isPlaying && channels[channel].source && !channels[channel].isMic) {
                    channels[channel].source.stop();
                    channels[channel].isPlaying = false;
                }
            });
            
            isPlaying = false;
            updatePlaybackStatus();
        }

        function stopChannel(channel) {
            if (channels[channel].isMic) {
                // 对于麦克风，我们只是断开连接，不停止流
                if (channels[channel].source) {
                    channels[channel].source.disconnect();
                    channels[channel].source = null;
                    channels[channel].isPlaying = false;
                }
            } else if (channels[channel].source && channels[channel].isPlaying) {
                channels[channel].source.stop();
                channels[channel].isPlaying = false;
            }
            
            updatePlaybackStatus();
        }

        // 更新播放状态
        function updatePlaybackStatus() {
            const statusIndicator = document.getElementById('playback-status');
            const statusText = document.getElementById('playback-status-text');
            
            let anyPlaying = false;
            for (let i = 1; i <= 8; i++) {
                const channelId = `ch${i}`;
                if (channels[channelId].isPlaying) {
                    anyPlaying = true;
                    break;
                }
            }
            
            if (anyPlaying) {
                statusIndicator.className = 'status-indicator status-active';
                statusText.textContent = translations[currentLanguage]['playback-status-text'];
                isPlaying = true;
            } else {
                statusIndicator.className = 'status-indicator status-inactive';
                statusText.textContent = translations[currentLanguage]['playback-status-text'];
                isPlaying = false;
            }
            
            // 更新活动通道计数
            let activeCount = 0;
            Object.keys(channels).forEach(channel => {
                if (channels[channel].isPlaying) activeCount++;
            });
            document.getElementById('active-channels').textContent = activeCount;
        }

        // 模式切换
        function initModeSwitcher() {
            const beginnerBtn = document.getElementById('beginner-mode-btn');
            const proBtn = document.getElementById('pro-mode-btn');
            const mixerContainer = document.getElementById('mixer-container');
            
            beginnerBtn.addEventListener('click', () => {
                if (currentMode === 'pro') {
                    currentMode = 'beginner';
                    mixerContainer.className = 'mixer-container beginner-mode';
                    beginnerBtn.classList.add('active');
                    proBtn.classList.remove('active');
                    updateUIForCurrentMode();
                    generateChannels();
                }
            });
            
            proBtn.addEventListener('click', () => {
                if (currentMode === 'beginner') {
                    currentMode = 'pro';
                    mixerContainer.className = 'mixer-container pro-mode';
                    proBtn.classList.add('active');
                    beginnerBtn.classList.remove('active');
                    updateUIForCurrentMode();
                    generateChannels();
                }
            });
        }

        // 更新UI模式文本
        function updateUIForCurrentMode() {
            document.getElementById('beginner-mode-btn').textContent = translations[currentLanguage]['beginner-mode'];
            document.getElementById('pro-mode-btn').textContent = translations[currentLanguage]['pro-mode'];
        }

        // 初始化语言选择器
        function initLanguageSelector() {
            const languageSelect = document.getElementById('language-select');
            
            // 设置默认语言
            languageSelect.value = currentLanguage;
            
            languageSelect.addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                updatePageLanguage();
            });
        }

        // 更新页面语言
        function updatePageLanguage() {
            // 更新静态文本
            document.getElementById('app-title').textContent = translations[currentLanguage]['app-title'];
            document.getElementById('master-title').textContent = translations[currentLanguage]['master-title'];
            document.getElementById('master-volume-label').textContent = translations[currentLanguage]['master-volume-label'];
            document.getElementById('filter-title').textContent = translations[currentLanguage]['filter-title'];
            document.getElementById('filter-freq-label').textContent = translations[currentLanguage]['filter-freq-label'];
            document.getElementById('filter-q-label').textContent = translations[currentLanguage]['filter-q-label'];
            document.getElementById('filter-type-label').textContent = translations[currentLanguage]['filter-type-label'];
            document.getElementById('eq-title').textContent = translations[currentLanguage]['eq-title'];
            document.getElementById('eq-low-label').textContent = translations[currentLanguage]['eq-low-label'];
            document.getElementById('eq-mid-label').textContent = translations[currentLanguage]['eq-mid-label'];
            document.getElementById('eq-high-label').textContent = translations[currentLanguage]['eq-high-label'];
            document.getElementById('gain-title').textContent = translations[currentLanguage]['gain-title'];
            document.getElementById('master-gain-label').textContent = translations[currentLanguage]['master-gain-label'];
            document.getElementById('play-btn-text').textContent = translations[currentLanguage]['play-btn-text'];
            document.getElementById('stop-btn-text').textContent = translations[currentLanguage]['stop-btn-text'];
            document.getElementById('audio-status-text').textContent = translations[currentLanguage]['audio-status-text'];
            document.getElementById('playback-status-text').textContent = translations[currentLanguage]['playback-status-text'];
            document.getElementById('active-channels-label').textContent = translations[currentLanguage]['active-channels-label'];
            document.getElementById('sample-rate-label').textContent = translations[currentLanguage]['sample-rate-label'];
            document.getElementById('footer-text').textContent = translations[currentLanguage]['footer-text'];
            document.getElementById('presets-title').textContent = translations[currentLanguage]['presets-title'];
            
            // 更新预设按钮文本
            document.querySelectorAll('.preset-btn').forEach(button => {
                const preset = button.getAttribute('data-preset');
                button.textContent = translations[currentLanguage][`preset-${preset}`];
            });
            
            // 更新模式按钮文本
            updateUIForCurrentMode();
            
            // 更新滤波器选项
            updateFilterTypeOptions();
            
            // 重新生成通道
            generateChannels();
            
            // 更新播放状态
            updatePlaybackStatus();
            
            // 更新音乐信息面板标签
            document.querySelectorAll('.stat-label').forEach((label, index) => {
                const labels = [
                    translations[currentLanguage]['music-duration'],
                    translations[currentLanguage]['music-bitrate'],
                    translations[currentLanguage]['music-sample-rate'],
                    translations[currentLanguage]['music-channels']
                ];
                if (index < labels.length) {
                    label.textContent = labels[index];
                }
            });
            
            document.querySelectorAll('.analysis-label').forEach((label, index) => {
                const labels = [
                    translations[currentLanguage]['music-bpm'],
                    translations[currentLanguage]['music-key'],
                    translations[currentLanguage]['music-loudness']
                ];
                if (index < labels.length) {
                    label.textContent = labels[index];
                }
            });
            
            // 更新音乐信息面板默认文本
            if (!currentMusicInfo) {
                document.getElementById('music-title').textContent = translations[currentLanguage]['music-no-file'];
                document.getElementById('music-artist').textContent = translations[currentLanguage]['music-drop-hint'];
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            initAudio();
            generateChannels();
            initModeSwitcher();
            initLanguageSelector();
            updateMeters();
            
            // 播放/停止按钮事件
            document.getElementById('play-btn').addEventListener('click', playAllChannels);
            document.getElementById('stop-btn').addEventListener('click', stopAllChannels);
        });
    </script>
</body>
</html>